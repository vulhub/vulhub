FROM ubuntu:latest

RUN apt-get update && apt-get install -y \
    git \
    build-essential \
    make \
    vim

RUN git clone https://github.com/nikdubois/vsftpd-2.3.4-infected.git

WORKDIR /vsftpd-2.3.4-infected

RUN `sed -i 's/LINK[[:space:]]*=[[:space:]]*-Wl,-s/LINK    =       -Wl,-s,-lcrypt/' Makefile` \
	&& make

RUN mkdir /usr/share/empty

RUN cp vsftpd /usr/local/sbin/vsftpd \
	&& cp vsftpd.8 /usr/local/man/man8 \
	&& cp vsftpd.conf.5 /usr/local/man/man5 \
	&& cp vsftpd.conf /etc

RUN mkdir /var/ftp/ \
	&& useradd -d /var/ftp ftp

RUN chown root:root /var/ftp \
	&& chmod og-w /var/ftp

RUN sed -i 's/anonymous_enable=YES/anonymous_enable=NO\nlocal_enable=YES/g' /etc/vsftpd.conf  

CMD ["/usr/local/sbin/vsftpd"]
