# Tomcat PUT方法临时文件session反序列化漏洞 (CVE-2025-24813)

Tomcat版本：9.0.98

## 环境搭建

```
docker compose up -d
```

运行完成后访问`http://your-ip:8080`即可看到Tomcat的Example页面。
![tomcat](1.png)

## 漏洞原理

漏洞本质是Tomcat配置了可写（readonly=false），导致我们可以往服务器写文件：

```xml
<servlet>
    <servlet-name>default</servlet-name>
    <servlet-class>org.apache.catalina.servlets.DefaultServlet</servlet-class>
    <init-param>
        <param-name>debug</param-name>
        <param-value>0</param-value>
    </init-param>
    <init-param>
        <param-name>listings</param-name>
        <param-value>false</param-value>
    </init-param>
    <init-param>
        <param-name>readonly</param-name>
        <param-value>false</param-value>
    </init-param>
    <load-on-startup>1</load-on-startup>
</servlet>
```
并且配置了session持久化到默认目录：
```xml
<Manager className="org.apache.catalina.session.PersistentManager">
        <Store className="org.apache.catalina.session.FileStore"/>
</Manager>
```
- 我们写入的文件是不会进入到默认目录的，而是会上传到webapps目录.  
- 但是tomcat在处理分段写文件时，会将分段的数据写入到session默认目录，并将`/` 转化为 `.` 作为默认文件名.从而导致可向session默认目录写入任意.开头的session文件，进行session反序列化.
- 本攻击依赖带有反序列化的依赖，此处使用`groovy-2.3.9.jar`作为漏洞依赖.

## 漏洞复现
使用 ysoserial 生成 payload:
```shell
java -jar ysoserial-all.jar Groovy1 "touch /tmp/success" > test.session
```

## 参考链接
- https://forum.butian.net/article/674
- https://tech.ec3o.fun/2025/03/12/Web-Vulnerability%20Reproduction/CVE-2025-24813/