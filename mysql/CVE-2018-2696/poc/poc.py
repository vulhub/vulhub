import mysql.connector
import threading
import time


def connect_to_mysql(password, threadId):
    while True:
        try:
            # 创建数据库连接对象
            conn = mysql.connector.connect(
                host="192.168.152.140",
                user="root",
                password=password
            )
            # 检查连接状态
            if conn.is_connected():
                print("线程%d已连接到数据库." % threadId)
            else:
                print("线程%d未连接到数据库." % threadId)
            # 关闭连接
            conn.close()
        except mysql.connector.Error as err:
            print(f"线程{threadId}连接发生错误: {err}")
            # 可以选择在这里处理连接丢失的情况，比如重新连接
            # 或者记录错误信息以供进一步分析
        # 等待一段时间后再次检测
        time.sleep(5)  # 5秒钟后再次检测


# 从文件中读取密码
with open('password.txt', 'r') as file:
    password = file.readline().strip()  # 读取并去除首尾空白符

print("成功载入payload.")

# 创建两个线程并启动
thread1 = threading.Thread(target=connect_to_mysql, args=(password, 1))
thread2 = threading.Thread(target=connect_to_mysql, args=(password, 2))
thread1.start()
thread2.start()

# 等待两个线程完成
thread1.join()
thread2.join()

print("所有线程连接完成.")
